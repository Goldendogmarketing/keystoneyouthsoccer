import{s as ie}from"./main-Cj5NYhJq.js";const X=Symbol.for("better-auth:broadcast-channel"),Se=()=>Math.floor(Date.now()/1e3);var Ee=class{listeners=new Set;name;constructor(e="better-auth.message"){this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:Se()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const n=JSON.parse(t.newValue??"{}");n?.event!=="session"||!n?.data||this.listeners.forEach(r=>r(n))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function Q(e="better-auth.message"){return globalThis[X]||(globalThis[X]=new Ee(e)),globalThis[X]}const z=Symbol.for("better-auth:focus-manager");var Oe=class{listeners=new Set;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function oe(){return globalThis[z]||(globalThis[z]=new Oe),globalThis[z]}const Z=Symbol.for("better-auth:online-manager");var Te=class{listeners=new Set;isOnline=typeof navigator<"u"?navigator.onLine:!0;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function K(){return globalThis[Z]||(globalThis[Z]=new Te),globalThis[Z]}let P=[],B=0;const $=4,ge=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(r){return n.lc=t.push(r),()=>{for(let u=B+$;u<P.length;)P[u]===r?P.splice(u,$):u+=$;let s=t.indexOf(r);~s&&(t.splice(s,1),--n.lc||n.off())}},notify(r,s){let u=!P.length;for(let o of t)P.push(o,n.value,r,s);if(u){for(B=0;B<P.length;B+=$)P[B](P[B+1],P[B+2],P[B+3]);P.length=0}},off(){},set(r){let s=n.value;s!==r&&(n.value=r,n.notify(s))},subscribe(r){let s=n.listen(r);return r(n.value),s},value:e};return n},Pe=5,k=6,W=10;let Le=(e,t,n,r)=>(e.events=e.events||{},e.events[n+W]||(e.events[n+W]=r(s=>{e.events[n].reduceRight((u,o)=>(o(u),u),{shared:{},...s})})),e.events[n]=e.events[n]||[],e.events[n].push(t),()=>{let s=e.events[n],u=s.indexOf(t);s.splice(u,1),s.length||(delete e.events[n],e.events[n+W](),delete e.events[n+W])}),Ie=1e3,ye=(e,t)=>Le(e,r=>{let s=t(r);s&&e.events[k].push(s)},Pe,r=>{let s=e.listen;e.listen=(...o)=>(!e.lc&&!e.active&&(e.active=!0,r()),s(...o));let u=e.off;return e.events[k]=[],e.off=()=>{u(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let o of e.events[k])o();e.events[k]=[]}},Ie)},()=>{e.listen=s,e.off=u}});const Ae=()=>typeof window>"u",Ue=(e,t,n,r)=>{const s=ge({data:null,error:null,isPending:!0,isRefetching:!1,refetch:f=>u(f)}),u=async f=>new Promise(i=>{const c=typeof r=="function"?r({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):r;n(t,{...c,query:{...c?.query,...f?.query},async onSuccess(a){s.set({data:a.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onSuccess?.(a)},async onError(a){const{request:d}=a,h=typeof d.retry=="number"?d.retry:d.retry?.attempts,m=d.retryAttempt||0;h&&m<h||(s.set({error:a.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onError?.(a))},async onRequest(a){const d=s.get();s.set({isPending:d.data===null,data:d.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await c?.onRequest?.(a)}}).catch(a=>{s.set({error:a,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})}).finally(()=>{i(void 0)})});e=Array.isArray(e)?e:[e];let o=!1;for(const f of e)f.subscribe(async()=>{Ae()||(o?await u():ye(s,()=>{const i=setTimeout(async()=>{o||(await u(),o=!0)},0);return()=>{s.off(),f.off(),clearTimeout(i)}}))});return s},F=()=>Math.floor(Date.now()/1e3),xe=5;function Ce(e){const{sessionAtom:t,sessionSignal:n,$fetch:r,options:s={}}=e,u=s.sessionOptions?.refetchInterval??0,o=s.sessionOptions?.refetchOnWindowFocus??!0,f=s.sessionOptions?.refetchWhenOffline??!1,i={lastSync:0,lastSessionRequest:0,cachedSession:void 0},c=()=>f||K().isOnline,a=_=>{if(!c())return;if(_?.event==="storage"){i.lastSync=F(),n.set(!n.get());return}const S=t.get();if(_?.event==="poll"){i.lastSessionRequest=F(),r("/get-session").then(l=>{l.error?t.set({...S,data:null,error:l.error}):t.set({...S,data:l.data,error:null}),i.lastSync=F(),n.set(!n.get())}).catch(()=>{});return}if(_?.event==="visibilitychange"){if(F()-i.lastSessionRequest<xe)return;i.lastSessionRequest=F()}(S?.data===null||S?.data===void 0||_?.event==="visibilitychange")&&(i.lastSync=F(),n.set(!n.get()))},d=_=>{Q().post({event:"session",data:{trigger:_},clientId:Math.random().toString(36).substring(7)})},h=()=>{u&&u>0&&(i.pollInterval=setInterval(()=>{t.get()?.data&&a({event:"poll"})},u*1e3))},m=()=>{i.unsubscribeBroadcast=Q().subscribe(()=>{a({event:"storage"})})},R=()=>{o&&(i.unsubscribeFocus=oe().subscribe(()=>{a({event:"visibilitychange"})}))},g=()=>{i.unsubscribeOnline=K().subscribe(_=>{_&&a({event:"visibilitychange"})})};return{init:()=>{h(),m(),R(),g(),Q().setup(),oe().setup(),K().setup()},cleanup:()=>{i.pollInterval&&(clearInterval(i.pollInterval),i.pollInterval=void 0),i.unsubscribeBroadcast&&(i.unsubscribeBroadcast(),i.unsubscribeBroadcast=void 0),i.unsubscribeFocus&&(i.unsubscribeFocus(),i.unsubscribeFocus=void 0),i.unsubscribeOnline&&(i.unsubscribeOnline(),i.unsubscribeOnline=void 0),i.lastSync=0,i.lastSessionRequest=0,i.cachedSession=void 0},triggerRefetch:a,broadcastSessionUpdate:d}}var Ne={},ae={};const H=Object.create(null),D=e=>Ne||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?H:globalThis),T=new Proxy(H,{get(e,t){return D()[t]??H[t]},has(e,t){return t in D()||t in H},set(e,t,n){const r=D(!0);return r[t]=n,!0},deleteProperty(e,t){if(!t)return!1;const n=D(!0);return delete n[t],!0},ownKeys(){const e=D(!0);return Object.keys(e)}});function v(e,t){return typeof process<"u"&&ae?ae[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}const j=1,b=4,A=8,E=24,ue={eterm:b,cons25:b,console:b,cygwin:b,dtterm:b,gnome:b,hurd:b,jfbterm:b,konsole:b,kterm:b,mlterm:b,mosh:E,putty:b,st:b,"rxvt-unicode-24bit":E,terminator:E,"xterm-kitty":E},Me=new Map(Object.entries({APPVEYOR:A,BUILDKITE:A,CIRCLECI:E,DRONE:A,GITEA_ACTIONS:E,GITHUB_ACTIONS:E,GITLAB_CI:A,TRAVIS:A})),Be=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Fe(){if(v("FORCE_COLOR")!==void 0)switch(v("FORCE_COLOR")){case"":case"1":case"true":return b;case"2":return A;case"3":return E;default:return j}if(v("NODE_DISABLE_COLORS")!==void 0&&v("NODE_DISABLE_COLORS")!==""||v("NO_COLOR")!==void 0&&v("NO_COLOR")!==""||v("TERM")==="dumb")return j;if(v("TMUX"))return E;if("TF_BUILD"in T&&"AGENT_NAME"in T)return b;if("CI"in T){for(const{0:e,1:t}of Me)if(e in T)return t;return v("CI_NAME")==="codeship"?A:j}if("TEAMCITY_VERSION"in T)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(v("TEAMCITY_VERSION"))!==null?b:j;switch(v("TERM_PROGRAM")){case"iTerm.app":return!v("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(v("TERM_PROGRAM_VERSION"))!==null?A:E;case"HyperTerm":case"MacTerm":return E;case"Apple_Terminal":return A}if(v("COLORTERM")==="truecolor"||v("COLORTERM")==="24bit")return E;if(v("TERM")){if(/truecolor/.exec(v("TERM"))!==null)return E;if(/^xterm-256/.exec(v("TERM"))!==null)return A;const e=v("TERM").toLowerCase();if(ue[e])return ue[e];if(Be.some(t=>t.exec(e)!==null))return b}return v("COLORTERM")?b:j}const U={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},te=["debug","info","success","warn","error"];function De(e,t){return te.indexOf(t)>=te.indexOf(e)}const je={info:U.fg.blue,success:U.fg.green,warn:U.fg.yellow,error:U.fg.red,debug:U.fg.magenta},qe=(e,t,n)=>{const r=new Date().toISOString();return n?`${U.dim}${r}${U.reset} ${je[e]}${e.toUpperCase()}${U.reset} ${U.bright}[Better Auth]:${U.reset} ${t}`:`${r} ${e.toUpperCase()} [Better Auth]: ${t}`},Ve=e=>{const t="error",n=Fe()!==1,r=(s,u,o=[])=>{if(!De(t,s))return;const f=qe(s,u,n);{s==="error"?console.error(f,...o):s==="warn"?console.warn(f,...o):console.log(f,...o);return}};return{...Object.fromEntries(te.map(s=>[s,(...[u,...o])=>r(s,u,o)])),get level(){return t}}};Ve();function $e(e){return e.charAt(0).toUpperCase()+e.slice(1)}var G=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function ke(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new G(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function We(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new G(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof G?t:new G(`Invalid base URL: ${e}. Please provide a valid base URL.`,String(t))}}function ee(e,t="/api/auth"){if(We(e),ke(e))return e;const n=e.replace(/\/+$/,"");return!t||t==="/"?n:(t=t.startsWith("/")?t:`/${t}`,`${n}${t}`)}function He(e,t,n,r,s){if(e)return ee(e,t);{const u=T.BETTER_AUTH_URL||T.NEXT_PUBLIC_BETTER_AUTH_URL||T.PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_AUTH_URL||(T.BASE_URL!=="/"?T.BASE_URL:void 0);if(u)return ee(u,t)}if(typeof window<"u"&&window.location)return ee(window.location.origin,t)}const Ge={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},Je={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},Ye=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,ce={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},Xe=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function Qe(e){return e instanceof Date&&!isNaN(e.getTime())}function ze(e){const t=Xe.exec(e);if(!t)return null;const[,n,r,s,u,o,f,i,c,a,d]=t;let h=new Date(Date.UTC(parseInt(n,10),parseInt(r,10)-1,parseInt(s,10),parseInt(u,10),parseInt(o,10),parseInt(f,10),i?parseInt(i.padEnd(3,"0"),10):0));if(c){const m=(parseInt(a,10)*60+parseInt(d,10))*(c==="+"?-1:1);h.setUTCMinutes(h.getUTCMinutes()+m)}return Qe(h)?h:null}function Ze(e,t={}){const{strict:n=!1,warnings:r=!1,reviver:s,parseDates:u=!0}=t;if(typeof e!="string")return e;const o=e.trim();if(o.length>0&&o[0]==='"'&&o.endsWith('"')&&!o.slice(1,-1).includes('"'))return o.slice(1,-1);const f=o.toLowerCase();if(f.length<=9&&f in ce)return ce[f];if(!Ye.test(o)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Je).some(([i,c])=>{const a=c.test(o);return a&&r&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${i} pattern`),a})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(o,(c,a)=>{if(c==="__proto__"||c==="constructor"&&a&&typeof a=="object"&&"prototype"in a){r&&console.warn(`[better-json] Dropping "${c}" key to prevent prototype pollution`);return}if(u&&typeof a=="string"){const d=ze(a);if(d)return d}return s?s(c,a):a})}catch(i){if(n)throw i;return e}}function Ke(e,t={strict:!0}){return Ze(e,t)}function et(e,t){const n=ge(!1),r=Ue(n,"/get-session",e,{method:"GET"});return ye(r,()=>{const s=Ce({sessionAtom:r,sessionSignal:n,$fetch:e,options:t});return s.init(),()=>{s.cleanup()}}),{session:r,$sessionSignal:n}}var tt=Object.defineProperty,nt=Object.defineProperties,rt=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,fe=(e,t,n)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,L=(e,t)=>{for(var n in t||(t={}))st.call(t,n)&&fe(e,n,t[n]);if(le)for(var n of le(t))it.call(t,n)&&fe(e,n,t[n]);return e},I=(e,t)=>nt(e,rt(t)),ot=class extends Error{constructor(e,t,n){super(t||e.toString(),{cause:n}),this.status=e,this.statusText=t,this.error=n,Error.captureStackTrace(this,this.constructor)}},at=async(e,t)=>{var n,r,s,u,o,f;let i=t||{};const c={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:i,hooks:c};for(const a of t?.plugins||[]){if(a.init){const d=await((n=a.init)==null?void 0:n.call(a,e.toString(),t));i=d.options||i,e=d.url}c.onRequest.push((r=a.hooks)==null?void 0:r.onRequest),c.onResponse.push((s=a.hooks)==null?void 0:s.onResponse),c.onSuccess.push((u=a.hooks)==null?void 0:u.onSuccess),c.onError.push((o=a.hooks)==null?void 0:o.onError),c.onRetry.push((f=a.hooks)==null?void 0:f.onRetry)}return{url:e,options:i,hooks:c}},de=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},ut=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function ct(e){if(typeof e=="number")return new de({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new de(e);case"exponential":return new ut(e);default:throw new Error("Invalid retry strategy")}}var lt=async e=>{const t={},n=async r=>typeof r=="function"?await r():r;if(e?.auth){if(e.auth.type==="Bearer"){const r=await n(e.auth.token);if(!r)return t;t.authorization=`Bearer ${r}`}else if(e.auth.type==="Basic"){const[r,s]=await Promise.all([n(e.auth.username),n(e.auth.password)]);if(!r||!s)return t;t.authorization=`Basic ${btoa(`${r}:${s}`)}`}else if(e.auth.type==="Custom"){const[r,s]=await Promise.all([n(e.auth.prefix),n(e.auth.value)]);if(!s)return t;t.authorization=`${r??""} ${s}`}}return t},ft=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function dt(e){const t=e.headers.get("content-type"),n=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const r=t.split(";").shift()||"";return ft.test(r)?"json":n.has(r)||r.startsWith("text/")?"text":"blob"}function ht(e){try{return JSON.parse(e),!0}catch{return!1}}function ne(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function he(e){try{return JSON.parse(e)}catch{return e}}function pe(e){return typeof e=="function"}function pt(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&pe(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&pe(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function gt(e){const t=new Headers(e?.headers),n=await lt(e);for(const[r,s]of Object.entries(n||{}))t.set(r,s);if(!t.has("content-type")){const r=yt(e?.body);r&&t.set("content-type",r)}return t}function yt(e){return ne(e)?"application/json":null}function vt(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(ne(e.body)&&!t.has("content-type")){for(const[n,r]of Object.entries(e?.body))r instanceof Date&&(e.body[n]=r.toISOString());return JSON.stringify(e.body)}return t.has("content-type")&&t.get("content-type")==="application/x-www-form-urlencoded"&&ne(e.body)?new URLSearchParams(e.body).toString():e.body}function mt(e,t){var n;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const r=(n=e.split("@")[1])==null?void 0:n.split("/")[0];return me.includes(r)?r.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function bt(e,t){let n;return!e?.signal&&e?.timeout&&(n=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:n,clearTimeout:()=>{n&&clearTimeout(n)}}}var _t=class ve extends Error{constructor(t,n){super(n||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,ve.prototype)}};async function J(e,t){const n=await e["~standard"].validate(t);if(n.issues)throw new _t(n.issues);return n.value}var me=["get","post","put","patch","delete"],wt=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,n){var r,s,u,o;const f=((s=(r=e.plugins)==null?void 0:r.find(i=>{var c;return(c=i.schema)!=null&&c.config?t.startsWith(i.schema.config.baseURL||"")||t.startsWith(i.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(f){let i=t;(u=f.config)!=null&&u.prefix&&i.startsWith(f.config.prefix)&&(i=i.replace(f.config.prefix,""),f.config.baseURL&&(t=t.replace(f.config.prefix,f.config.baseURL))),(o=f.config)!=null&&o.baseURL&&i.startsWith(f.config.baseURL)&&(i=i.replace(f.config.baseURL,""));const c=f.schema[i];if(c){let a=I(L({},n),{method:c.method,output:c.output});return n?.disableValidation||(a=I(L({},a),{body:c.input?await J(c.input,n?.body):n?.body,params:c.params?await J(c.params,n?.params):n?.params,query:c.query?await J(c.query,n?.query):n?.query})),{url:t,options:a}}}return{url:t,options:n}}}),Rt=e=>{async function t(n,r){const s=I(L(L({},e),r),{plugins:[...e?.plugins||[],wt(e||{}),...r?.plugins||[]]});if(e?.catchAllError)try{return await re(n,s)}catch(u){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:u}}}return await re(n,s)}return t};function St(e,t){const{baseURL:n,params:r,query:s}=t||{query:{},params:{},baseURL:""};let u=e.startsWith("http")?e.split("/").slice(0,3).join("/"):n||"";if(e.startsWith("@")){const d=e.toString().split("@")[1].split("/")[0];me.includes(d)&&(e=e.replace(`@${d}/`,"/"))}u.endsWith("/")||(u+="/");let[o,f]=e.replace(u,"").split("?");const i=new URLSearchParams(f);for(const[d,h]of Object.entries(s||{})){if(h==null)continue;let m;if(typeof h=="string")m=h;else if(Array.isArray(h)){for(const R of h)i.append(d,R);continue}else m=JSON.stringify(h);i.set(d,m)}if(r)if(Array.isArray(r)){const d=o.split("/").filter(h=>h.startsWith(":"));for(const[h,m]of d.entries()){const R=r[h];o=o.replace(m,R)}}else for(const[d,h]of Object.entries(r))o=o.replace(`:${d}`,String(h));o=o.split("/").map(encodeURIComponent).join("/"),o.startsWith("/")&&(o=o.slice(1));let c=i.toString();return c=c.length>0?`?${c}`.replace(/\+/g,"%20"):"",u.startsWith("http")?new URL(`${o}${c}`,u):`${u}${o}${c}`}var re=async(e,t)=>{var n,r,s,u,o,f,i,c;const{hooks:a,url:d,options:h}=await at(e,t),m=pt(h),R=new AbortController,g=(n=h.signal)!=null?n:R.signal,y=St(d,h),M=vt(h),_=await gt(h),S=mt(d,h);let l=I(L({},h),{url:y,headers:_,body:M,method:S,signal:g});for(const O of a.onRequest)if(O){const w=await O(l);typeof w=="object"&&w!==null&&(l=w)}("pipeTo"in l&&typeof l.pipeTo=="function"||typeof((r=t?.body)==null?void 0:r.pipe)=="function")&&("duplex"in l||(l.duplex="half"));const{clearTimeout:x}=bt(h,R);let p=await m(l.url,l);x();const q={response:p,request:l};for(const O of a.onResponse)if(O){const w=await O(I(L({},q),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?p.clone():p}));w instanceof Response?p=w:typeof w=="object"&&w!==null&&(p=w.response)}if(p.ok){if(!(l.method!=="HEAD"))return{data:"",error:null};const w=dt(p),C={data:null,response:p,request:l};if(w==="json"||w==="text"){const N=await p.text(),Re=(u=l.jsonParser)!=null?u:he;C.data=await Re(N)}else C.data=await p[w]();l?.output&&l.output&&!l.disableValidation&&(C.data=await J(l.output,C.data));for(const N of a.onSuccess)N&&await N(I(L({},C),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?p.clone():p}));return t?.throw?C.data:{data:C.data,error:null}}const _e=(f=t?.jsonParser)!=null?f:he,V=await p.text(),se=ht(V),Y=se?await _e(V):null,we={response:p,responseText:V,request:l,error:I(L({},Y),{status:p.status,statusText:p.statusText})};for(const O of a.onError)O&&await O(I(L({},we),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?p.clone():p}));if(t?.retry){const O=ct(t.retry),w=(c=t.retryAttempt)!=null?c:0;if(await O.shouldAttemptRetry(w,p)){for(const N of a.onRetry)N&&await N(q);const C=O.getDelay(w);return await new Promise(N=>setTimeout(N,C)),await re(e,I(L({},t),{retryAttempt:w+1}))}}if(t?.throw)throw new ot(p.status,p.statusText,se?Y:V);return{data:null,error:I(L({},Y),{status:p.status,statusText:p.statusText})}};const Et=(e,t)=>{const n="credentials"in Request.prototype,r=He(e?.baseURL,e?.basePath)??"/api/auth",s=e?.plugins?.flatMap(l=>l.fetchPlugins).filter(l=>l!==void 0)||[],u={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:e?.fetchOptions?.onSuccess,onError:e?.fetchOptions?.onError,onRequest:e?.fetchOptions?.onRequest,onResponse:e?.fetchOptions?.onResponse}},{onSuccess:o,onError:f,onRequest:i,onResponse:c,...a}=e?.fetchOptions||{},d=Rt({baseURL:r,...n?{credentials:"include"}:{},method:"GET",jsonParser(l){return l?Ke(l,{strict:!1}):null},customFetchImpl:fetch,...a,plugins:[u,...a.plugins||[],...e?.disableDefaultFetchPlugins?[]:[Ge],...s]}),{$sessionSignal:h,session:m}=et(d,e),R=e?.plugins||[];let g={},y={$sessionSignal:h,session:m},M={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const _=[{signal:"$sessionSignal",matcher(l){return l==="/sign-out"||l==="/update-user"||l==="/sign-up/email"||l==="/sign-in/email"||l==="/delete-user"||l==="/verify-email"||l==="/revoke-sessions"||l==="/revoke-session"||l==="/change-email"}}];for(const l of R)l.getAtoms&&Object.assign(y,l.getAtoms?.(d)),l.pathMethods&&Object.assign(M,l.pathMethods),l.atomListeners&&_.push(...l.atomListeners);const S={notify:l=>{y[l].set(!y[l].get())},listen:(l,x)=>{y[l].subscribe(x)},atoms:y};for(const l of R)l.getActions&&Object.assign(g,l.getActions?.(d,S,e));return{get baseURL(){return r},pluginsActions:g,pluginsAtoms:y,pluginPathMethods:M,atomListeners:_,$fetch:d,$store:S}};function Ot(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function Tt(e,t,n){const r=t[e],{fetchOptions:s,query:u,...o}=n||{};return r||(s?.method?s.method:o&&Object.keys(o).length>0?"POST":"GET")}function Pt(e,t,n,r,s){function u(o=[]){return new Proxy(function(){},{get(f,i){if(typeof i!="string"||i==="then"||i==="catch"||i==="finally")return;const c=[...o,i];let a=e;for(const d of c)if(a&&typeof a=="object"&&d in a)a=a[d];else{a=void 0;break}return typeof a=="function"||Ot(a)?a:u(c)},apply:async(f,i,c)=>{const a="/"+o.map(_=>_.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),d=c[0]||{},h=c[1]||{},{query:m,fetchOptions:R,...g}=d,y={...h,...R},M=Tt(a,n,d);return await t(a,{...y,body:M==="GET"?void 0:{...g,...y?.body||{}},query:m||y?.query,method:M,async onSuccess(_){if(await y?.onSuccess?.(_),!s||y.disableSignal)return;const S=s.filter(x=>x.matcher(a));if(!S.length)return;const l=new Set;for(const x of S){const p=r[x.signal];if(!p)return;if(l.has(x.signal))continue;l.add(x.signal);const q=p.get();setTimeout(()=>{p.set(!q)},10)}}})}})}return u()}function Lt(e){const{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:r,$fetch:s,atomListeners:u,$store:o}=Et(e);let f={};for(const[i,c]of Object.entries(r))f[`use${$e(i)}`]=c;return Pt({...n,...f,$fetch:s,$store:o},s,t,r,u)}function be(e,t){if(e instanceof Promise)throw new Error(t)}function It(e,t){const n={},r=[];for(const s in e){const u=e[s]["~standard"].validate(t[s]);if(be(u,`Validation must be synchronous, but ${s} returned a Promise.`),u.issues){r.push(...u.issues.map(o=>({...o,message:o.message,path:[s,...o.path??[]]})));continue}n[s]=u.value}return r.length?{issues:r}:{value:n}}var At={};function Ut(e){const t=e.runtimeEnvStrict??e.runtimeEnv??At;if(e.emptyStringAsUndefined??!1)for(const[g,y]of Object.entries(t))y===""&&delete t[g];if(e.skipValidation){if(e.extends)for(const g of e.extends)g.skipValidation=!0;return t}const n=typeof e.client=="object"?e.client:{},r=typeof e.server=="object"?e.server:{},s=typeof e.shared=="object"?e.shared:{},u=e.isServer??(typeof window>"u"||"Deno"in window),o=u?{...r,...s,...n}:{...n,...s},f=e.createFinalSchema?.(o,u)?.["~standard"].validate(t)??It(o,t);be(f,"Validation must be synchronous");const i=e.onValidationError??(g=>{throw console.error("❌ Invalid environment variables:",g),new Error("Invalid environment variables")}),c=e.onInvalidAccess??(()=>{throw new Error("❌ Attempted to access a server-side environment variable on the client")});if(f.issues)return i(f.issues);const a=g=>e.clientPrefix?!g.startsWith(e.clientPrefix)&&!(g in s):!0,d=g=>u||!a(g),h=g=>g==="__esModule"||g==="$$typeof",m=(e.extends??[]).reduce((g,y)=>Object.assign(g,y),{}),R=Object.assign(m,f.value);return new Proxy(R,{get(g,y){if(typeof y=="string"&&!h(y))return d(y)?Reflect.get(g,y):c(y)}})}const xt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,TSS_CLIENT_OUTPUT_DIR:"dist/client",TSS_DEV_SERVER:"false",TSS_ROUTER_BASEPATH:"",TSS_SERVER_FN_BASE:"/_serverFn/",VITE_BASE_URL:"http://localhost:3000"},Ct=Ut({clientPrefix:"VITE_",client:{VITE_BASE_URL:ie().url().default("http://localhost:3000"),VITE_STRIPE_PUBLISHABLE_KEY:ie().startsWith("pk_").optional()},runtimeEnv:xt}),Nt=Lt({baseURL:Ct.VITE_BASE_URL}),{signIn:Bt,signUp:Ft,signOut:Dt,useSession:jt,$fetch:qt}=Nt;export{Ft as a,Bt as b,Dt as s,jt as u};
